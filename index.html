<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Bunker Tycoon 3D</title>
<style>
body { margin:0; overflow:hidden; background:#222; font-family:Arial; }
#ui { position:absolute; top:10px; left:10px; color:white; }
button { margin:5px; padding:5px 10px; }
</style>
</head>
<body>
<div id="ui">
  Argent: <span id="money">100</span><br>
  <button onclick="build('dortoir')">Construire Dortoir (50$)</button>
  <button onclick="build('atelier')">Construire Atelier (100$)</button>
  <button onclick="build('reservoir')">Construire Réservoir (75$)</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x333333);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(10,15,20);
camera.lookAt(0,0,0);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lumière
let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(20,20,20);
scene.add(light);
scene.add(new THREE.AmbientLight(0x555555));

// Sol
let ground = new THREE.Mesh(
  new THREE.PlaneGeometry(50,50),
  new THREE.MeshStandardMaterial({color:0x444444})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// Variables du jeu
let money = 100;
let buildings = [];
let nextX = 0;
let nextZ = 0;

// Fonction construction
function build(type){
  let cost=0,color=0x00ff00;
  if(type==='dortoir'){ cost=50;color=0x00ff00; }
  if(type==='atelier'){ cost=100;color=0xffff00; }
  if(type==='reservoir'){ cost=75;color=0x00ffff; }
  if(money<cost) return alert("Pas assez d'argent !");
  money-=cost;
  updateMoney();

  let geometry = new THREE.BoxGeometry(2,2,2);
  let material = new THREE.MeshStandardMaterial({color:color});
  let cube = new THREE.Mesh(geometry, material);
  cube.position.set(nextX,1,nextZ);
  scene.add(cube);

  buildings.push({mesh:cube,type:type,level:1});

  // Avancer position pour le prochain bâtiment
  nextX += 3;
  if(nextX>12){ nextX=0; nextZ+=3; }

  // Animation simple
  cube.scale.set(0.1,0.1,0.1);
  let scale=0.1;
  let anim=setInterval(()=>{
    scale+=0.05;
    cube.scale.set(scale,scale,scale);
    if(scale>=1) clearInterval(anim);
  },30);
}

// Upgrade bâtiment
function upgrade(building){
  let upgradeCost = building.level*50;
  if(money<upgradeCost) return alert("Pas assez d'argent !");
  money -= upgradeCost;
  building.level++;
  updateMoney();
  building.mesh.scale.y +=0.5; // augmente visuellement
}

// Génération automatique d'argent
function generateMoney(){
  buildings.forEach(b=>{
    if(b.type==='dortoir') money += b.level*1;
    if(b.type==='atelier') money += b.level*2;
    if(b.type==='reservoir') money += b.level*1.5;
  });
  updateMoney();
  randomEvent();
}

// Mettre à jour affichage argent
function updateMoney(){
  document.getElementById('money').textContent = Math.floor(money);
}

// Événements aléatoires
function randomEvent(){
  if(Math.random()<0.01){
    let bonus = Math.floor(Math.random()*50+10);
    money += bonus;
    updateMoney();
    alert("Événement bonus ! Tu gagnes "+bonus+"$");
  }
}

// Boucle jeu
setInterval(generateMoney,1000);

function animate(){
  requestAnimationFrame(animate);
  renderer.render(scene,camera);
}
animate();

// Sélection et upgrade au clic
window.addEventListener('click',(e)=>{
  let mouse = new THREE.Vector2();
  mouse.x = (e.clientX/window.innerWidth)*2-1;
  mouse.y = -(e.clientY/window.innerHeight)*2+1;

  let raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(mouse,camera);
  let intersects = raycaster.intersectObjects(buildings.map(b=>b.mesh));
  if(intersects.length>0){
    let b = buildings.find(b=>b.mesh===intersects[0].object);
    upgrade(b);
  }
});
</script>
</body>
</html>
